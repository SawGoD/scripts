# üîê Secure Server Setup

–°–∫—Ä–∏–ø—Ç –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ SSH —Å–µ—Ä–≤–µ—Ä–∞ —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º iptables –∏ whitelist IP-–∞–¥—Ä–µ—Å–æ–≤.

## üìã –û–ø–∏—Å–∞–Ω–∏–µ

–î–∞–Ω–Ω—ã–π —Å–∫—Ä–∏–ø—Ç –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä—É–µ—Ç –ø—Ä–æ—Ü–µ—Å—Å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ SSH –Ω–∞ Linux —Å–µ—Ä–≤–µ—Ä–µ. –û–Ω –≤–∫–ª—é—á–∞–µ—Ç –≤ —Å–µ–±—è:

- **–°–º–µ–Ω—É —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–≥–æ SSH –ø–æ—Ä—Ç–∞** –¥–ª—è –∑–∞—â–∏—Ç—ã –æ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –∞—Ç–∞–∫
- **–ù–∞—Å—Ç—Ä–æ–π–∫—É whitelist IP-–∞–¥—Ä–µ—Å–æ–≤** –¥–ª—è –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –¥–æ—Å—Ç—É–ø–∞ –∫ —Å–µ—Ä–≤–µ—Ä—É
- **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫—É—é –Ω–∞—Å—Ç—Ä–æ–π–∫—É iptables** —Å –±–µ–∑–æ–ø–∞—Å–Ω—ã–º–∏ –ø—Ä–∞–≤–∏–ª–∞–º–∏ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
- **–ü—Ä–æ–≤–µ—Ä–∫—É –∑–∞–Ω—è—Ç–æ—Å—Ç–∏ –ø–æ—Ä—Ç–æ–≤** –ø–µ—Ä–µ–¥ –∏—Ö –Ω–∞–∑–Ω–∞—á–µ–Ω–∏–µ–º
- **–°–æ–∑–¥–∞–Ω–∏–µ —Ä–µ–∑–µ—Ä–≤–Ω–æ–π –∫–æ–ø–∏–∏** –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ SSH
- **–ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–π –≤—ã–±–æ—Ä –ø–æ—Ä—Ç–æ–≤** (80 HTTP, 443 HTTPS/VPN)

## üéØ –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

### ‚úÖ –ß—Ç–æ –¥–µ–ª–∞–µ—Ç —Å–∫—Ä–∏–ø—Ç:
- **–ü—Ä–æ–≤–µ—Ä—è–µ—Ç —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π –±—ç–∫–∞–ø** –∏ –ø—Ä–µ–¥–ª–∞–≥–∞–µ—Ç –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–∏ –ø–æ–≤—Ç–æ—Ä–Ω–æ–º –∑–∞–ø—É—Å–∫–µ
- **–¶–≤–µ—Ç–Ω–æ–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å** –¥–ª—è —É–ª—É—á—à–µ–Ω–∏—è —á–∏—Ç–∞–µ–º–æ—Å—Ç–∏ (–∑–µ–ª–µ–Ω—ã–π/–∫—Ä–∞—Å–Ω—ã–π/—Ä–æ–∑–æ–≤—ã–π/–∂–µ–ª—Ç—ã–π/–≥–æ–ª—É–±–æ–π)
- **–í—ã–±–æ—Ä –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö –ø–æ—Ä—Ç–æ–≤** (80 HTTP, 443 HTTPS/VPN, 1080 SOCKS)
- –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å —É–∫–∞–∑–∞–Ω–Ω–æ–≥–æ –ø–æ—Ä—Ç–∞
- –°–æ–∑–¥–∞–µ—Ç –±—ç–∫–∞–ø —Ç–µ–∫—É—â–µ–π –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ SSH (`/etc/ssh/sshd_config.bak`)
- –ú–µ–Ω—è–µ—Ç –ø–æ—Ä—Ç SSH –Ω–∞ —É–∫–∞–∑–∞–Ω–Ω—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º
- –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç iptables —Å –±–µ–∑–æ–ø–∞—Å–Ω—ã–º–∏ –ø—Ä–∞–≤–∏–ª–∞–º–∏:
  - –ë–ª–æ–∫–∏—Ä—É–µ—Ç –≤–µ—Å—å –≤—Ö–æ–¥—è—â–∏–π —Ç—Ä–∞—Ñ–∏–∫ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
  - –†–∞–∑—Ä–µ—à–∞–µ—Ç —Ç–æ–ª—å–∫–æ —É–∫–∞–∑–∞–Ω–Ω—ã–µ IP –¥–ª—è SSH (–∏–ª–∏ –≤—Å–µ, –µ—Å–ª–∏ –≤—ã–±—Ä–∞–Ω–æ)
  - –†–∞–∑—Ä–µ—à–∞–µ—Ç –≤—ã–±—Ä–∞–Ω–Ω—ã–µ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø–æ—Ä—Ç—ã (80, 443)
  - –î–æ–±–∞–≤–ª—è–µ—Ç –∑–∞—â–∏—Ç—É –æ—Ç —Å–∫–∞–Ω–µ—Ä–æ–≤ –ø–æ—Ä—Ç–æ–≤
- –°–æ—Ö—Ä–∞–Ω—è–µ—Ç –ø—Ä–∞–≤–∏–ª–∞ iptables –¥–ª—è –∞–≤—Ç–æ–∑–∞–≥—Ä—É–∑–∫–∏
- –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞–µ—Ç SSH —Å–µ—Ä–≤–∏—Å

### üõ°Ô∏è –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å:
- **DROP –ø–æ–ª–∏—Ç–∏–∫–∞ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é** –¥–ª—è –≤—Ö–æ–¥—è—â–∏—Ö —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π
- **Whitelist –ø–æ–¥—Ö–æ–¥** –¥–ª—è SSH –¥–æ—Å—Ç—É–ø–∞
- **–ó–∞—â–∏—Ç–∞ –æ—Ç SYN flood** –∏ —Å–∫–∞–Ω–µ—Ä–æ–≤ –ø–æ—Ä—Ç–æ–≤
- **–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã—Ö —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π**
- **–†–∞–∑—Ä–µ—à–µ–Ω–∏–µ loopback –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞**

## üìã –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è

### –°–∏—Å—Ç–µ–º–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è:
- **–û–°**: Ubuntu/Debian (–∏–ª–∏ –¥—Ä—É–≥–∏–µ Linux –¥–∏—Å—Ç—Ä–∏–±—É—Ç–∏–≤—ã —Å systemd)
- **–ü—Ä–∞–≤–∞**: root –¥–æ—Å—Ç—É–ø –æ–±—è–∑–∞—Ç–µ–ª–µ–Ω
- **–ü–∞–∫–µ—Ç—ã**: `iptables`, `ss`, `systemctl`

### –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º—ã–µ –ø–∞–∫–µ—Ç—ã:
- `iptables-persistent` - –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –ø—Ä–∞–≤–∏–ª iptables

## üöÄ –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

### 1. –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞
```bash
# –°–∫–∞—á–∞–π—Ç–µ —Å–∫—Ä–∏–ø—Ç –Ω–∞ —Å–µ—Ä–≤–µ—Ä
wget https://your-repo/secure_server.sh
# –∏–ª–∏
curl -O https://your-repo/secure_server.sh

# –°–¥–µ–ª–∞–π—Ç–µ —Å–∫—Ä–∏–ø—Ç –∏—Å–ø–æ–ª–Ω—è–µ–º—ã–º
chmod +x secure_server.sh
```

### 2. –ó–∞–ø—É—Å–∫
```bash
# –í–ê–ñ–ù–û: –ó–∞–ø—É—Å–∫–∞–π—Ç–µ —Ç–æ–ª—å–∫–æ –æ—Ç root!
sudo ./secure_server.sh
```

### 3. –ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞

#### –®–∞–≥ 1: –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ –±—ç–∫–∞–ø–∞ (–≤ —Å–∞–º–æ–º –Ω–∞—á–∞–ª–µ)
**–ü–ï–†–í–´–ú –î–ï–õ–û–ú** —Å–∫—Ä–∏–ø—Ç –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –Ω–∞–ª–∏—á–∏–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ –±—ç–∫–∞–ø–∞ SSH –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏:
```
üîç –ù–∞–π–¥–µ–Ω —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π –±—ç–∫–∞–ø SSH –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏: /etc/ssh/sshd_config.bak
   –î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è: 2024-01-15 14:30:25.123456789 +0000

üîÑ –í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å SSH –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é –∏–∑ –±—ç–∫–∞–ø–∞? (Y/n): 
```

**–í–∞—Ä–∏–∞–Ω—Ç—ã –æ—Ç–≤–µ—Ç–∞:**
- `Y` –∏–ª–∏ `Enter` - –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é –∏ **–∑–∞–≤–µ—Ä—à–∏—Ç —Å–∫—Ä–∏–ø—Ç**
- `n` - –ø—Ä–æ–¥–æ–ª–∂–∏—Ç —Å –Ω–∞—Å—Ç—Ä–æ–π–∫–æ–π –Ω–æ–≤–æ–π –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏

‚ö†Ô∏è **–ï—Å–ª–∏ –±—ç–∫–∞–ø–∞ –Ω–µ—Ç** - —Å–∫—Ä–∏–ø—Ç —Å—Ä–∞–∑—É –ø–µ—Ä–µ—Ö–æ–¥–∏—Ç –∫ –Ω–∞—Å—Ç—Ä–æ–π–∫–µ.

#### –®–∞–≥ 2: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ whitelist IP
```
üîê –í–≤–µ–¥–∏—Ç–µ IP-–∞–¥—Ä–µ—Å–∞, –∫–æ—Ç–æ—Ä—ã–º —Ä–∞–∑—Ä–µ—à—ë–Ω –¥–æ—Å—Ç—É–ø –ø–æ SSH (—á–µ—Ä–µ–∑ –∑–∞–ø—è—Ç—É—é).
   –ï—Å–ª–∏ —Ö–æ—Ç–∏—Ç–µ —Ä–∞–∑—Ä–µ—à–∏—Ç—å –¥–æ—Å—Ç—É–ø –≤—Å–µ–º ‚Äî –≤–≤–µ–¥–∏—Ç–µ 'n' –∏ –Ω–∞–∂–º–∏—Ç–µ Enter.

üìù IP-–∞–¥—Ä–µ—Å–∞: 
```

**–ü—Ä–∏–º–µ—Ä—ã –≤–≤–æ–¥–∞:**
- `192.168.1.100,203.0.113.45` - –¥–æ—Å—Ç—É–ø —Ç–æ–ª—å–∫–æ —Å —É–∫–∞–∑–∞–Ω–Ω—ã—Ö IP
- `192.168.1.0/24` - –¥–æ—Å—Ç—É–ø —Å –ø–æ–¥—Å–µ—Ç–∏
- `n` - –¥–æ—Å—Ç—É–ø —Å –ª—é–±–æ–≥–æ IP (–Ω–µ —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –¥–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞)

#### –®–∞–≥ 3: –í—ã–±–æ—Ä SSH –ø–æ—Ä—Ç–∞
```
–í–≤–µ–¥–∏—Ç–µ –∂–µ–ª–∞–µ–º—ã–π SSH-–ø–æ—Ä—Ç: 
```

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:**
- –ò–∑–±–µ–≥–∞–π—Ç–µ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã—Ö –ø–æ—Ä—Ç–æ–≤ (22, 80, 443, 21, 25)
- –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –ø–æ—Ä—Ç—ã –≤ –¥–∏–∞–ø–∞–∑–æ–Ω–µ 1024-65535
- –ü–æ–ø—É–ª—è—Ä–Ω—ã–µ –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤—ã: 2222, 2022, 8022, 22000

#### –®–∞–≥ 4: –í—ã–±–æ—Ä –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö –ø–æ—Ä—Ç–æ–≤
```
–•–æ—Ç–∏—Ç–µ –æ—Ç–∫—Ä—ã—Ç—å –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø–æ—Ä—Ç—ã?
   80   (HTTP) - –¥–ª—è –≤–µ–±-—Å–∞–π—Ç–æ–≤
   443  (HTTPS/VPN) - –¥–ª—è –≤–µ–±-—Å–∞–π—Ç–æ–≤ –∏ VPN
   1080 (SOCKS) - –¥–ª—è SOCKS –ø—Ä–æ–∫—Å–∏

–û—Ç–∫—Ä—ã—Ç—å –ø–æ—Ä—Ç 80 (HTTP)? (y/N): 
–û—Ç–∫—Ä—ã—Ç—å –ø–æ—Ä—Ç 443 (HTTPS/VPN)? (Y/n): 
–û—Ç–∫—Ä—ã—Ç—å –ø–æ—Ä—Ç 1080 (SOCKS)? (y/N): 
```

**–í–∞—Ä–∏–∞–Ω—Ç—ã –æ—Ç–≤–µ—Ç–∞:**
- **–ü–æ—Ä—Ç 80**: `y` - –¥–∞, `N` - –Ω–µ—Ç (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –Ω–µ—Ç)
- **–ü–æ—Ä—Ç 443**: `Y` - –¥–∞ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é), `n` - –Ω–µ—Ç
- **–ü–æ—Ä—Ç 1080**: `y` - –¥–∞, `N` - –Ω–µ—Ç (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –Ω–µ—Ç)

**–ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è:**
- **–¢–æ–ª—å–∫–æ SSH**: –æ—Å—Ç–∞–≤–∏—Ç—å –≤—Å–µ –ø–æ—Ä—Ç—ã –∑–∞–∫—Ä—ã—Ç—ã–º–∏
- **–í–µ–±-—Å–∞–π—Ç**: –æ—Ç–∫—Ä—ã—Ç—å 80 –∏ 443
- **VPN —Å–µ—Ä–≤–µ—Ä**: –æ—Ç–∫—Ä—ã—Ç—å —Ç–æ–ª—å–∫–æ 443
- **SOCKS –ø—Ä–æ–∫—Å–∏**: –æ—Ç–∫—Ä—ã—Ç—å —Ç–æ–ª—å–∫–æ 1080
- **–ü–æ–ª–Ω—ã–π –Ω–∞–±–æ—Ä**: –æ—Ç–∫—Ä—ã—Ç—å 80, 443 –∏ 1080

## üé® –¶–≤–µ—Ç–æ–≤–∞—è —Å—Ö–µ–º–∞

–°–∫—Ä–∏–ø—Ç –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Ü–≤–µ—Ç–∞ –¥–ª—è —É–ª—É—á—à–µ–Ω–∏—è —á–∏—Ç–∞–µ–º–æ—Å—Ç–∏:
- üü¢ **–ó–µ–ª–µ–Ω—ã–π**: —É—Å–ø–µ—à–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ (–ø–æ—Ä—Ç —Å–≤–æ–±–æ–¥–µ–Ω, –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞)
- üî¥ **–ö—Ä–∞—Å–Ω—ã–π**: –æ—à–∏–±–∫–∏ (–ø–æ—Ä—Ç –∑–∞–Ω—è—Ç, –Ω–µ–≤–µ—Ä–Ω—ã–π –≤–≤–æ–¥)
- ü©∑ **–†–æ–∑–æ–≤—ã–π**: –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è (–∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏, —Å—Ç–∞—Ç—É—Å)
- üü° **–ñ–µ–ª—Ç—ã–π**: –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è (–¥–æ—Å—Ç—É–ø –æ—Ç–∫—Ä—ã—Ç –¥–ª—è –≤—Å–µ—Ö IP)
- ü©µ **–ì–æ–ª—É–±–æ–π**: –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –∏ –≤–∞–∂–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è (–ø–æ—Ä—Ç—ã, IP-–∞–¥—Ä–µ—Å–∞, –∫–æ–º–∞–Ω–¥—ã)

## üìä –ü—Ä–∏–º–µ—Ä —Ä–∞–±–æ—Ç—ã

### –ü–µ—Ä–≤—ã–π –∑–∞–ø—É—Å–∫ (–±–µ–∑ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ –±—ç–∫–∞–ø–∞):
```bash
root@server:~# ./secure_server.sh

üîê –í–≤–µ–¥–∏—Ç–µ IP-–∞–¥—Ä–µ—Å–∞, –∫–æ—Ç–æ—Ä—ã–º —Ä–∞–∑—Ä–µ—à—ë–Ω –¥–æ—Å—Ç—É–ø –ø–æ SSH (—á–µ—Ä–µ–∑ –∑–∞–ø—è—Ç—É—é).
   –ï—Å–ª–∏ —Ö–æ—Ç–∏—Ç–µ —Ä–∞–∑—Ä–µ—à–∏—Ç—å –¥–æ—Å—Ç—É–ø –≤—Å–µ–º ‚Äî –≤–≤–µ–¥–∏—Ç–µ 'n' –∏ –Ω–∞–∂–º–∏—Ç–µ Enter.

üìù IP-–∞–¥—Ä–µ—Å–∞: 192.168.1.100,203.0.113.45

–í–≤–µ–¥–∏—Ç–µ –∂–µ–ª–∞–µ–º—ã–π SSH-–ø–æ—Ä—Ç: 2222
‚úÖ –ü–æ—Ä—Ç 2222 —Å–≤–æ–±–æ–¥–µ–Ω.

–•–æ—Ç–∏—Ç–µ –æ—Ç–∫—Ä—ã—Ç—å –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø–æ—Ä—Ç—ã?
   80   (HTTP) - –¥–ª—è –≤–µ–±-—Å–∞–π—Ç–æ–≤
   443  (HTTPS/VPN) - –¥–ª—è –≤–µ–±-—Å–∞–π—Ç–æ–≤ –∏ VPN
   1080 (SOCKS) - –¥–ª—è SOCKS –ø—Ä–æ–∫—Å–∏

–û—Ç–∫—Ä—ã—Ç—å –ø–æ—Ä—Ç 80 (HTTP)? (y/N): y
–û—Ç–∫—Ä—ã—Ç—å –ø–æ—Ä—Ç 443 (HTTPS/VPN)? (Y/n): y
–û—Ç–∫—Ä—ã—Ç—å –ø–æ—Ä—Ç 1080 (SOCKS)? (y/N): y
‚úÖ –ë—É–¥–µ—Ç –æ—Ç–∫—Ä—ã—Ç –ø–æ—Ä—Ç 80 (HTTP)
‚úÖ –ë—É–¥–µ—Ç –æ—Ç–∫—Ä—ã—Ç –ø–æ—Ä—Ç 443 (HTTPS/VPN)
‚úÖ –ë—É–¥–µ—Ç –æ—Ç–∫—Ä—ã—Ç –ø–æ—Ä—Ç 1080 (SOCKS)

–î–µ–ª–∞–µ–º –±—ç–∫–∞–ø /etc/ssh/sshd_config ‚Üí /etc/ssh/sshd_config.bak
‚úÖ SSH —Ç–µ–ø–µ—Ä—å —Å–ª—É—à–∞–µ—Ç –ø–æ—Ä—Ç 2222

üî• –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º iptables...
   üîì –†–∞–∑—Ä–µ—à—ë–Ω –¥–æ—Å—Ç—É–ø –ø–æ SSH —Å 192.168.1.100
   üîì –†–∞–∑—Ä–µ—à—ë–Ω –¥–æ—Å—Ç—É–ø –ø–æ SSH —Å 203.0.113.45
   üîì –†–∞–∑—Ä–µ—à—ë–Ω –ø–æ—Ä—Ç 80 (HTTP)
   üîì –†–∞–∑—Ä–µ—à—ë–Ω –ø–æ—Ä—Ç 443 (HTTPS/VPN)
   üîì –†–∞–∑—Ä–µ—à—ë–Ω –ø–æ—Ä—Ç 1080 (SOCKS)

–°–æ—Ö—Ä–∞–Ω—è–µ–º –ø—Ä–∞–≤–∏–ª–∞...

‚úÖ –í—Å—ë –≥–æ—Ç–æ–≤–æ!
üîê –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –ø–æ SSH —Ç–µ–ø–µ—Ä—å —á–µ—Ä–µ–∑ –ø–æ—Ä—Ç: 2222
–†–∞–∑—Ä–µ—à—ë–Ω –¥–æ—Å—Ç—É–ø —Ç–æ–ª—å–∫–æ —Å —É–∫–∞–∑–∞–Ω–Ω—ã—Ö IP:
   - 192.168.1.100
   - 203.0.113.45

–û—Ç–∫—Ä—ã—Ç—ã–µ –ø–æ—Ä—Ç—ã:
   - 2222 (SSH)
   - 80 (HTTP)
   - 443 (HTTPS/VPN)
   - 1080 (SOCKS)

–ò—Å–ø–æ–ª—å–∑—É–π:
    ssh -p 2222 root@<—Ç–≤–æ–π-—Å–µ—Ä–≤–µ—Ä>
```

### –ü–æ–≤—Ç–æ—Ä–Ω—ã–π –∑–∞–ø—É—Å–∫ (—Å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–º –±—ç–∫–∞–ø–æ–º):
```bash
root@server:~# ./secure_server.sh

üîç –ù–∞–π–¥–µ–Ω —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π –±—ç–∫–∞–ø SSH –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏: /etc/ssh/sshd_config.bak
   –î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è: 2024-01-15 14:30:25.123456789 +0000

üîÑ –í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å SSH –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é –∏–∑ –±—ç–∫–∞–ø–∞? (Y/n): Y

üîÑ –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é –∏–∑ –±—ç–∫–∞–ø–∞...
‚úÖ SSH –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞ –∏–∑ –±—ç–∫–∞–ø–∞
üîê SSH —Å–Ω–æ–≤–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–∞ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–º –ø–æ—Ä—Ç—É 22
üß† –î–ª—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ: ssh root@<—Ç–≤–æ–π-—Å–µ—Ä–≤–µ—Ä>
```

### –ü–æ–≤—Ç–æ—Ä–Ω—ã–π –∑–∞–ø—É—Å–∫ (–ø—Ä–æ–¥–æ–ª–∂–µ–Ω–∏–µ –±–µ–∑ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è):
```bash
root@server:~# ./secure_server.sh

üîç –ù–∞–π–¥–µ–Ω —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π –±—ç–∫–∞–ø SSH –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏: /etc/ssh/sshd_config.bak
   –î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è: 2024-01-15 14:30:25.123456789 +0000

üîÑ –í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å SSH –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é –∏–∑ –±—ç–∫–∞–ø–∞? (Y/n): n

‚û°Ô∏è  –ü—Ä–æ–¥–æ–ª–∂–∞–µ–º —Å —Ç–µ–∫—É—â–µ–π –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–µ–π...

üîê –í–≤–µ–¥–∏—Ç–µ IP-–∞–¥—Ä–µ—Å–∞, –∫–æ—Ç–æ—Ä—ã–º —Ä–∞–∑—Ä–µ—à—ë–Ω –¥–æ—Å—Ç—É–ø –ø–æ SSH (—á–µ—Ä–µ–∑ –∑–∞–ø—è—Ç—É—é)...
```

## üîß –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏

### –ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ —Å–∏—Å—Ç–µ–º–µ:

#### SSH –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è (`/etc/ssh/sshd_config`):
```bash
# –ò–∑–º–µ–Ω—è–µ—Ç—Å—è —Å—Ç—Ä–æ–∫–∞:
Port 2222  # –≤–º–µ—Å—Ç–æ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–≥–æ 22
```

#### iptables –ø—Ä–∞–≤–∏–ª–∞:
```bash
# –ü–æ–ª–∏—Ç–∏–∫–∏ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
iptables -P INPUT DROP
iptables -P FORWARD DROP
iptables -P OUTPUT ACCEPT

# –°–∏—Å—Ç–µ–º–Ω—ã–µ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è
iptables -A INPUT -i lo -j ACCEPT
iptables -A INPUT -m conntrack --ctstate RELATED,ESTABLISHED -j ACCEPT

# SSH –¥–æ—Å—Ç—É–ø (–ø—Ä–∏–º–µ—Ä –¥–ª—è whitelist)
iptables -A INPUT -p tcp -s 192.168.1.100 --dport 2222 -j ACCEPT
iptables -A INPUT -p tcp -s 203.0.113.45 --dport 2222 -j ACCEPT

# –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø–æ—Ä—Ç—ã (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
iptables -A INPUT -p tcp --dport 80 -j ACCEPT    # –µ—Å–ª–∏ –≤—ã–±—Ä–∞–Ω HTTP
iptables -A INPUT -p tcp --dport 443 -j ACCEPT   # –µ—Å–ª–∏ –≤—ã–±—Ä–∞–Ω HTTPS/VPN
iptables -A INPUT -p tcp --dport 1080 -j ACCEPT  # –µ—Å–ª–∏ –≤—ã–±—Ä–∞–Ω SOCKS

# –ó–∞—â–∏—Ç–∞ –æ—Ç —Å–∫–∞–Ω–µ—Ä–æ–≤
iptables -A INPUT -p tcp ! --syn -m state --state NEW -j DROP
```

### –§–∞–π–ª—ã –∏ —Å–µ—Ä–≤–∏—Å—ã:
- **–ë—ç–∫–∞–ø SSH**: `/etc/ssh/sshd_config.bak`
- **–°–µ—Ä–≤–∏—Å SSH**: –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è —á–µ—Ä–µ–∑ `systemctl restart ssh`
- **iptables –ø—Ä–∞–≤–∏–ª–∞**: —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è —á–µ—Ä–µ–∑ `netfilter-persistent save`

## ‚ö†Ô∏è –í–∞–∂–Ω—ã–µ –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è

### üö® –ö–†–ò–¢–ò–ß–ï–°–ö–ò –í–ê–ñ–ù–û:
1. **–¢–µ—Å—Ç–∏—Ä—É–π—Ç–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ** –ø–µ—Ä–µ–¥ –∑–∞–∫—Ä—ã—Ç–∏–µ–º —Ç–µ–∫—É—â–µ–π SSH —Å–µ—Å—Å–∏–∏
2. **–ó–∞–ø–æ–º–Ω–∏—Ç–µ –Ω–æ–≤—ã–π –ø–æ—Ä—Ç** - —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π 22 –±—É–¥–µ—Ç –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω
3. **–°–æ—Ö—Ä–∞–Ω–∏—Ç–µ IP –∞–¥—Ä–µ—Å–∞** whitelist'–∞ –≤ –±–µ–∑–æ–ø–∞—Å–Ω–æ–º –º–µ—Å—Ç–µ
4. **–ò–º–µ–π—Ç–µ –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–π –¥–æ—Å—Ç—É–ø** –∫ —Å–µ—Ä–≤–µ—Ä—É (VNC, –∫–æ–Ω—Å–æ–ª—å –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞)

### üîÑ –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ—Å–ª–µ —É—Å—Ç–∞–Ω–æ–≤–∫–∏:
```bash
# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ SSH —Å–ª—É—à–∞–µ—Ç –Ω–æ–≤—ã–π –ø–æ—Ä—Ç
ss -tuln | grep :2222

# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∏–ª–∞ iptables
iptables -L -n

# –¢–µ—Å—Ç–æ–≤–æ–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ (–ù–ï –∑–∞–∫—Ä—ã–≤–∞–π—Ç–µ —Ç–µ–∫—É—â—É—é —Å–µ—Å—Å–∏—é!)
ssh -p 2222 root@YOUR_SERVER_IP
```

## üîß –£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º

### –ü—Ä–æ–±–ª–µ–º–∞: –ù–µ –º–æ–≥—É –ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –ø–æ—Å–ª–µ —É—Å—Ç–∞–Ω–æ–≤–∫–∏
**–†–µ—à–µ–Ω–∏–µ:**
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç–µ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –ø–æ—Ä—Ç: `ssh -p NEW_PORT user@server`
2. –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ –≤–∞—à IP –≤ whitelist'–µ
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ —Å–µ—Ä–≤–∏—Å SSH –∑–∞–ø—É—â–µ–Ω: `systemctl status ssh`

### –ü—Ä–æ–±–ª–µ–º–∞: –ü–æ—Ä—Ç –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –∫–∞–∫ –∑–∞–Ω—è—Ç—ã–π
**–†–µ—à–µ–Ω–∏–µ:**
1. –í—ã–±–µ—Ä–∏—Ç–µ –¥—Ä—É–≥–æ–π –ø–æ—Ä—Ç
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–∞–∫–æ–π –ø—Ä–æ—Ü–µ—Å—Å –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –ø–æ—Ä—Ç: `ss -tuln | grep :PORT`
3. –ü—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –æ—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –∫–æ–Ω—Ñ–ª–∏–∫—Ç—É—é—â–∏–π —Å–µ—Ä–≤–∏—Å

### –ü—Ä–æ–±–ª–µ–º–∞: –û—à–∏–±–∫–∏ iptables
**–†–µ—à–µ–Ω–∏–µ:**
1. –û—á–∏—Å—Ç–∏—Ç–µ –ø—Ä–∞–≤–∏–ª–∞: `iptables -F && iptables -X`
2. –í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –¥–æ—Å—Ç—É–ø: `iptables -P INPUT ACCEPT`
3. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ —Å–∫—Ä–∏–ø—Ç

### –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ SSH –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏:
```bash
# –í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∏–∑ –±—ç–∫–∞–ø–∞
cp /etc/ssh/sshd_config.bak /etc/ssh/sshd_config
systemctl restart ssh
```

### –û—á–∏—Å—Ç–∫–∞ iptables (—ç–∫—Å—Ç—Ä–µ–Ω–Ω—ã–π –¥–æ—Å—Ç—É–ø):
```bash
# –í–ù–ò–ú–ê–ù–ò–ï: –û—Ç–∫—Ä–æ–µ—Ç –≤—Å–µ –ø–æ—Ä—Ç—ã!
iptables -F
iptables -X
iptables -P INPUT ACCEPT
iptables -P FORWARD ACCEPT
iptables -P OUTPUT ACCEPT
```

## üìù –õ–∏—Ü–µ–Ω–∑–∏—è

–°–∫—Ä–∏–ø—Ç –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç—Å—è "–∫–∞–∫ –µ—Å—Ç—å" –±–µ–∑ –∫–∞–∫–∏—Ö-–ª–∏–±–æ –≥–∞—Ä–∞–Ω—Ç–∏–π. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –Ω–∞ —Å–≤–æ–π —Å—Ç—Ä–∞—Ö –∏ —Ä–∏—Å–∫.

## üë®‚Äçüíª –ê–≤—Ç–æ—Ä

–°–æ–∑–¥–∞–Ω–æ –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ —Å–µ—Ä–≤–µ—Ä–æ–≤.

---

**‚ö° –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç:**
```bash
sudo ./secure_server.sh
```

**üîó –ü–æ—Å–ª–µ —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –ø–æ–¥–∫–ª—é—á–∞–π—Ç–µ—Å—å:**
```bash
ssh -p YOUR_NEW_PORT user@YOUR_SERVER
``` 